{% extends "document.html" %}

{% block body %}
<div class="col-md-12">

    {% include 'parts/flash.html' %}
    {% include 'attendance/header.html' %}
    {# {% include 'parts/employee-profile-photo.html' %} #}
    {# {% include 'attendance/tabs-calendar.html' %} #}
    <div class="tab-content pt-3 pb-2 pl-3 pr-3">
        <h1 class="text-center h4 mb-2">Attendance Sheet</h1>
        <p class="text-center mb-3">{{mCalendar|format_date('dddd - MMM DD, YYYY')}}</p>
        <div class="table-responsive">
            <table class="table table-sm">
                <tr class="text-center">
                    <th class="align-middle text-center" rowspan="2">No.</th>
                    <th class="align-middle text-center" rowspan="2">Campus</th>
                    <th class="align-middle" rowspan="2">Name</th>
                    <th class="align-middle" colspan="2">Sex</th>
                    <th>AM</th>
                    <th class="align-middle" rowspan="2"></th>
                    <th>AM</th>
                    <th class="align-middle" rowspan="2"></th>
                    <th>PM</th>
                    <th class="align-middle" rowspan="2"></th>
                    <th>PM</th>
                    <th class="align-middle" rowspan="2"></th>
                </tr>
                <tr class="text-center">
                    <th>M</th>
                    <th>F</th>
                    <th>In</th>
                    <th>Out</th>
                    <th>In</th>
                    <th>Out</th>
                </tr>
                {% for attendance in attendances %}
                    <tr>
                        <td class="text-center">{{loop.index}}</td>
                        <td><em>{{attendance.employment.campus|capitalize}}</em></td>
                        <td>
                            <a class="privy-name text-left d-block" href="/attendance/employee/{{attendance.employeeId}}/employment/{{attendance.employmentId}}?start={{mCalendar.startOf('month').format('YYYY-MM-DD')}}&amp;end={{mCalendar.endOf('month').format('YYYY-MM-DD')}}">
                                {{attendance.employee.firstName}} {{attendance.employee.lastName}} {{attendance.employee.suffix}}
                            </a>
                            
                        </td>
                        <td class="text-center">{% if attendance.employee.gender == 'M' %}✓{% endif %}</td>
                        <td class="text-center">{% if attendance.employee.gender == 'F' %}✓{% endif %}</td>
                        
                        {% if attendance.type == 'normal' %}
                            
                            <td>{{attendance.logs[0].dateTime|default(true, '')|format_date('hh:mm')}}</td>
                            <td>{#<img src="/images/signature-sample.jpeg" alt="sign">#}</td>
                            <td>
                                {% set log = attendance.logs[1] %}
                                {% if log.extra %}
                                    <a title="View Location" href="https://nominatim.openstreetmap.org/ui/reverse.html?lat={{log.extra.lat}}&lon={{log.extra.lon}}"> 
                                        {{attendance.logs[1].dateTime|default(true, '')|format_date('hh:mm')}}  
                                        
                                        <svg style="width:18px;height:18px" viewBox="0 0 24 24">
                                            <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
                                        </svg>
                                    </a>
                                {% else %}
                                    {{log.dateTime|default(true, '')|format_date('hh:mm')}}
                                {% endif %}
                            </td>
                            <td>{#<img src="/images/signature-sample.jpeg" alt="sign">#}
                            </td>
                            <td>
                                {% set log = attendance.logs[2] %}
                                {% if log.extra %}
                                    <a title="View Location" href="https://nominatim.openstreetmap.org/ui/reverse.html?lat={{log.extra.lat}}&lon={{log.extra.lon}}"> 
                                        {{log.dateTime|default(true, '')|format_date('hh:mm')}}  
                                        
                                        <svg style="width:18px;height:18px" viewBox="0 0 24 24">
                                            <path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
                                        </svg>
                                    </a>
                                {% else %}
                                    {{log.dateTime|default(true, '')|format_date('hh:mm')}}
                                {% endif %}
                                
                            </td>
                            <td>{#<img src="/images/signature-sample.jpeg" alt="sign">#}</td>
                            <td>{{attendance.logs[3].dateTime|default(true, '')|format_date('hh:mm')}}</td>
                            <td>{#<img src="/images/signature-sample.jpeg" alt="sign">#}</td>

                        {% else %}
                            <td colspan="8">{{attendance.type|capitalize|replace('Pass', 'Pass Slip')|replace('Wfh', 'WFH')}}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
    var vApp = new Vue({
        el: '#vApp',
        delimiters: ["${", "}"],
        mixins: [
            window.vuelidate.validationMixin,
            window.vuelidateExtendMixin,
        ],
        data: {
            
        },
        validations: {
            
        },
        methods: {
            onSubmit: function(){
                var me = this;
                me.$v.$touch()
                if (me.$v.$error) {
                    alert('Please correct the errors to continue.')
                } else {
                    me.$nextTick(function() {
                        me.$refs.form.submit();
                    });
                }
            }
        }
    });
</script>
{% endblock %}

