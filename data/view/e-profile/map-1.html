{% extends "document.html" %}
{% block styles %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="   crossorigin=""/>
{% endblock %}

{% block body %}
<div class="col-md-12" id="vApp" v-cloak v-bind:data-pending="pending">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <div class="d-flex align-items-start">
            <h1 class="h4 h3-md">Online Log Verification</h1>
        </div>
        <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group mr-2">
                <a href="/e-profile/home" class="btn btn-sm btn-outline-primary">Back</a>
            </div>
        </div>
    </div>
    <div class="mb-5 tab-content p-3">
        <div id="carousel-map" class="carousel slide" data-ride="carousel" data-touch="false" data-interval="false">
            {# <ol class="carousel-indicators">
                <li data-target="#carousel-map" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-map" data-slide-to="1"></li>
                <li data-target="#carousel-map" data-slide-to="2"></li>
                <li data-target="#carousel-map" data-slide-to="3"></li>
            </ol> #}
            <div class="carousel-inner p-3">
                {# 1 #}
                <div class="carousel-item active">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <img src="/images/phone-loc2.jpg" alt="">
                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-left">
                            <div class="col-lg-6">
                                <h1 class="h2 mb-5 text-center text-md-left">Before You Begin...</h1>
                                <p>We encourage you to use your mobile phone for a smoother log transaction.</p>
                                <p>Your device must have a camera.</p>
                                <p>You must allow HRIS to use your device location and camera.</p>
                                <p>A desktop or laptop computer can be used but the location services might not work properly.</p>
                                <p>How your location and photos are used is detailed in our Data Privacy statement.</p>
                                <div class="form-check pt-3">
                                        <input v-model="dontme" class="form-check-input" type="checkbox" value="1" id="dontme">
                                        <label class="form-check-label" for="dontme">
                                            Do not show again
                                        </label>
                                    </div>
                                <div class="text-center pt-3">
                                    
                                    <button v-on:click="page=2-1" type="button" class="btn btn-full-width btn-primary">Understood. Let's Start! </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 2 #}
                <div class="carousel-item">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <img src="/images/phone-loc.jpg" alt="">
                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-6">
                                <h1 class="h2 mb-5">Verify Location</h1>
                                <p>We need to verify that you are within the school campus.</p>
                                <div class="text-center pt-5">
                                    <button v-on:click="page=3-1" type="button" class="btn btn-full-width btn-primary">Detect Location</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 3 #}
                <div class="carousel-item ">
                    <div class="row">
                        <div class="col-md-7 text-center text-md-right pt-5 pb-5">
                            <div id="map" style="height:300px"></div>
                        </div>
                        <div class="col-md-5 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-9">
                                <h1 v-if="mapLocationErrorMode === 0" class="h2 mb-5">Location Verified</h1>
                                <h1 v-else class="h2 mb-5">Location Result</h1>
                                <div v-if="mapLocationErrorMode === 0">
                                    <p>You are inside ${mapLocationResultName}.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 1" class="text-left">
                                    <p>Unfortunately, your detected location is outside of our school. </p>
                                    <p>If you think this is inaccurate, please try any of the following: </p>
                                    <ul>
                                        <li>Use your phone</li>
                                        <li>Connect with mobile data</li>
                                        <li>Enable GPS</li>
                                    </ul>
                                </div>
                                <div v-if="mapLocationErrorMode === 2">
                                    <p>You did not allow HRIS to get your location.</p>
                                    <p>Please go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 3">
                                    <p>Service currently unavailable. Please go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 4">
                                    <p>Location service failed. Please try again later or go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 5">
                                    <p>Unknown error. Please go to one of our scanners to log.</p>
                                </div>

                                <div class="text-center pt-5">
                                    <button v-if="mapLocationErrorMode===0" v-on:click="page=4-1" type="button" class="btn btn-full-width btn-primary">Next</button>
                                    <template v-else>
                                        <button v-on:click="detectLocation" type="button" class="btn btn-full-width btn-primary mb-3">Try Again</button>
                                        <a href="/e-profile/dtr/{{employment._id}}" class="btn btn-light btn-full-width">I'll just go to the scanner.</a>
                                    </template>    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 4 #}
                <div class="carousel-item ">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <div style="position: relative; width: 245px; height: 500px; display:inline-block;">
                                <div style="position: absolute; left: 15px; top:62px; width: 215px; height:285px; overflow: hidden;">
                                <img v-if="webcamPhoto" style="position: absolute; left:50%; transform: translateX(-50%); top: 0; z-index:5; height:100%" v-bind:src="webcamPhoto" alt="photo">
                                <video id="webcam-feed" style="position: absolute; left:50%; transform: translateX(-50%); top: 0;"></video>
                                <canvas id="webcam-snapshot"></canvas>
                                </div>
                                <img src="/images/phone-cam.jpg" alt="">
                            </div>

                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-6">
                                <h1 v-if="!webcamPhoto" class="h2 mb-5">Identity Verification</h1>
                                <h1 v-else class="h2 mb-5">Ready to Submit</h1>

                                <div v-if="webcamError">
                                    <p>${webcamError}</p>
                                    <div class="text-center pt-5">
                                        <button v-on:click="webcamStart" type="button" class="btn btn-full-width btn-primary">Try Again</button>
                                    </div>
                                </div>
                                <div v-else>
                                    <div v-if="!webcamPhoto">
                                        <p>We need to know its you. Please take a selfie.</p>
                                    </div>
                                    <div v-else>
                                        <p>${nextLogCheckPoint}: ${time} <br>
                                        Location: ${mapLocationResultName}</p>
                                    </div>
                                   
                                    <div class="text-center">
                                        <button v-if="!webcamPhoto" v-on:click="snap" type="button" class="mt-5 btn btn-full-width btn-primary">Take Selfie</button>
                                        <div v-else>
                                            <div style="font-size:12px" class="alert alert-warning text-left mb-2 mt-2">
                                                Warning: Under the Civil Service Commission, the falsification of DTRs would render the authors thereof administratively liable for Dishonesty and Grave Misconduct. <br><br>
                                                Punishment may range from suspension to dismissal.
                                            </div>
                                            <button v-on:click="log" type="button" class="btn btn-full-width btn-primary">Submit Attendance to HR (${countdown})</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="{{app.url}}/js/axios.min.js"></script>
<script src="{{app.url}}/js/media-devices.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="   crossorigin=""></script>
<script>
    var employmentId = '{{employment._id}}';
    var employeeId = '{{employee._id}}';
</script>
<script>
    var geo = _.get(window, 'navigator.geolocation');
    var initPage = 0
    var firstRun = localStorage.getItem('hrisOnlineLogFirstRun');
    if(firstRun){
        initPage = 1
    }

    var countdownTimer = null;
    var vApp = new Vue({
        el: '#vApp',
        delimiters: ["${", "}"],
        mixins: [
            window.vuelidate.validationMixin,
            window.vuelidateExtendMixin,
        ],
        data: {
            pending: false,
            page: 0,
            latLon: [],
            map: null,
            mapMarker: null,
            mapLocationErrorMode: 0,
            mapLocationResultName: '',
            locationMessage: '',

            webcamPhotoSnapper: null,
            webcamLoaded: false,
            webcamPhoto: '',
            webcamError: '',

            time: '',
            countdown: 20,
            dontme: 0,
            currentLogCheckPoint: 0,
        },
        validations: {
            
        },
        created: function(){
            this.page = initPage
        },
        computed: {
            nextLogCheckPoint: function(){
                if(this.currentLogCheckPoint === 0){
                    return 'Morning In'
                } else if(this.currentLogCheckPoint === 1){
                    return 'Morning Out'
                } else if(this.currentLogCheckPoint === 2){
                    return 'Afternoon In'
                } else if(this.currentLogCheckPoint === 3){
                    return 'Afternoon Out'
                } else if(this.currentLogCheckPoint === 4){
                    return 'Extended In'
                } else if(this.currentLogCheckPoint === 5){
                    return 'Extended Out'
                }
            }
        },
        mounted: function(){

            var me = this;

            document.getElementById("webcam-feed").addEventListener('loadedmetadata', function(e){
                me.webcamLoaded = true
            })

            jQuery('#carousel-map').on('slide.bs.carousel', function (e) {
                me.page = e.to
            })

            setInterval(function(){
                me.time = moment.tz('Asia/Manila').format('hh:mm A')
            }, 1000)

            
        },
        watch: {
            page: function (newPage, oldPage) {
                var me = this;
                jQuery('#carousel-map').carousel(newPage)
                
                if(newPage === 0) { // 1

                } else if(newPage === 1) { // 2
                    if(me.dontme){
                        localStorage.setItem('hrisOnlineLogFirstRun', true);
                    }
                    me.webcamStop()

                } else if(newPage ===2) { // 3
                    me.loadMap()
                    me.detectLocation()
                    
                } else if(newPage === 3) { // 4
                    me.webcamStart()
                    me.loadLogPoint()

                } else if(newPage === 4) { // 5
                    

                }
            }
        },
        methods: {
            startTimer: function(){
                var me = this;
                if(countdownTimer){
                    clearInterval(countdownTimer)
                    me.countdown = 20
                }
                countdownTimer = setInterval(function(){
                    me.countdown -= 1
                    if(me.countdown <= 0) {
                        clearInterval(countdownTimer)
                        me.pending = true
                        me.log()
                    }
                }, 1000)
            },
            log: function(){
                var me = this;
                me.pending = true;

                let logType = 1
                if(this.currentLogCheckPoint === 0){
                    logType = 1
                } else if(this.currentLogCheckPoint === 1){
                    logType = 0
                } else if(this.currentLogCheckPoint === 2){
                    logType = 1
                } else if(this.currentLogCheckPoint === 3){
                    logType = 0
                } else if(this.currentLogCheckPoint === 4){
                    logType = 1
                } else if(this.currentLogCheckPoint === 5){
                    logType = 0
                }

                var body = {
                    mode: logType,
                    webcamPhoto: me.webcamPhoto,
                    lat: _.get(me, 'latLon.0'),
                    lon: _.get(me, 'latLon.1'),
                };

                axios.post('/e-profile/dtr/' + employmentId + '/logs', body, {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                    var data = _.get(response, 'data')
                    window.location.href = '/e-profile/dtr/' + employmentId + '';
                }).catch(function (error) {
                    if (error.response) {
                        // Request made, server responded with a status code outside of 2xx
                        // console.error(error.response.status)
                        var err = error.response.data;
                        console.error(err)
                        alert(err.msg)

                    } else if (error.request) {
                        var msg = 'The request was made but no response was received'
                        console.error(msg);

                    } else {
                        var msg = 'Something happened in setting up the request that triggered an Error.'
                        console.error(msg, error.message);

                    }
                    me.pending = false;
                    window.location.href = '/e-profile/dtr/' + employmentId + '/online';
                }).then(function () {
                })
            },
            snap: function(){
                this.webcamSnap()
                this.startTimer()
            },
            detectLocation: function(){
                var me = this;

                if (!geo) {
                    alert("Your browser does not support the online time-in/time-out. Please go to the scanner to log.");
                } else { 

                    me.pending = true;

                    geo.getCurrentPosition(
                        function(location){  
                            let lat = _.get(location, 'coords.latitude');
                            let lon = _.get(location, 'coords.longitude');

                            /*
                            // mosqueda
                            lat = 10.61821
                            lon = 122.59340

                            // baterna
                            lat = 10.58386
                            lon = 122.67105 

                            // salvador
                            lat = 10.69994
                            lon = 122.65108  
                            */

                            let body = {
                                coordinates: [lon, lat],
                            }

                            me.map.setView([lat, lon], 17);
                            var pin = L.icon({
                                iconUrl: '/images/marker-1.png',
                                iconSize:     [33, 50], // size of the icon
                                shadowSize:   [50, 64], // size of the shadow
                                iconAnchor:   [16.5, 50], // point of the icon which will correspond to marker's location
                            });

                            if(me.mapMarker){
                                me.map.removeLayer(me.mapMarker)
                            }
                            me.mapMarker = L.marker([lat, lon], {icon: pin}).bindPopup("Your Location!").addTo(me.map);

                            axios.post('/e-profile/dtr/' + employmentId + '/location', body, {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                                var data = _.get(response, 'data')
                                console.log(data)
                                me.mapLocationErrorMode = 0
                                me.mapLocationResultName = data
                                me.latLon = [lat, lon]
                                me.locationMessage = 'Your are inside ' + data + '.'

                            }).catch(function (error) {
                                if (error.response) {
                                    // Request made, server responded with a status code outside of 2xx
                                    // console.error(error.response.status)
                                    var err = error.response.data;
                                    console.error(err)

                                } else if (error.request) {
                                    var msg = 'The request was made but no response was received'
                                    console.error(msg);

                                } else {
                                    var msg = 'Something happened in setting up the request that triggered an Error.'
                                    console.error(msg, error.message);

                                }

                                me.mapLocationResultName = ''
                                me.mapLocationErrorMode = 1
                                me.latLon = [lat, lon]
                                me.locationMessage = ''

                                me.pending = false;

                            }).then(function(){
                                me.pending = false;
                            })

                        }, 
                        function(positionError) {

                            var code = _.get(positionError, 'code', 0)
                            
                            var err = ''
                            if (code === 1) { // PERMISSION_DENIED
                                me.mapLocationErrorMode = 2
                                err = "You must allow this permission \nto use the service: \nPermissions > Location > Allow\nOtherwise, you can go to one of our scanner to log."
                            } else if (code === 2) { // POSITION_UNAVAILABLE
                                me.mapLocationErrorMode = 3
                                err = "Service currently unavailable. Please go to the scanner to log."
                            } else if (code === 3) { // TIMEOUT
                                me.mapLocationErrorMode = 4
                                err = "Location failed. Please try again later or go to the scanner to log."
                            } else {
                                err = "Unknown error. Please go to the scanner to log."
                            }


                            me.pending = false;

                        },
                        { 
                            timeout: 5000,
                            enableHighAccuracy: true
                        }
                    ); 

                }
            },
            loadLogPoint: function(){
                var me = this;
                me.pending = true;

                axios.get('/e-profile/dtr/' + employmentId + '/log-point', {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                    var data = _.get(response, 'data')
                    me.currentLogCheckPoint = _.get(data, 'checkPoint', 0)
                    if(me.currentLogCheckPoint === 1 || me.currentLogCheckPoint === 2){

                    } else {
                        me.pending = false;

                        alert(me.nextLogCheckPoint+' is not allowed online. Please use our scanners.')
                        window.location.href = '/e-profile/dtr/' + employmentId + '';
                    }
                }).catch(function (error) {
                    if (error.response) {
                        // Request made, server responded with a status code outside of 2xx
                        // console.error(error.response.status)
                        var err = error.response.data;
                        console.error(err)

                    } else if (error.request) {
                        var msg = 'The request was made but no response was received'
                        console.error(msg);

                    } else {
                        var msg = 'Something happened in setting up the request that triggered an Error.'
                        console.error(msg, error.message);

                    }
                    me.pending = false;

                }).then(function () {
                    me.pending = false;
                })

            },
            loadMap: function(){
                var me = this;
                if(!me.map){
                    me.map = L.map('map');
                } else {
                    return ;
                }
                var map = me.map
                map.setView([10.69951, 122.65067], 15);
                map.scrollWheelZoom.disable();
                var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia29zaW5peCIsImEiOiJjamFsd2t3Y3QydW05MzNxdXUyeWV6azhoIn0.aqHKe7JGKQrNMD5-WP8xDQ', {
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1
                }).addTo(map);

                var polygon = L.polygon([{{salvador|stringify|safe}}], {color: 'green'}).bindPopup("Salvador Campus Boundaries");
                polygon.addTo(map);

                polygon = L.polygon([{{mosqueda|stringify|safe}}], {color: 'green'}).bindPopup("Mosqueda Campus Boundaries");
                polygon.addTo(map);

                polygon = L.polygon([{{baterna|stringify|safe}}], {color: 'green'}).bindPopup("Baterna Campus Boundaries");
                polygon.addTo(map);
            },


            webcamStart: function(){
                var me = this
                if(!me.webcamPhotoSnapper){
                    me.pending = true
                    MediaDevicesPresets.createWebcamPhotoSnapper(
                        document.getElementById("webcam-feed"),
                        document.getElementById("webcam-snapshot"),
                        {
                            width: 352,
                            height: 285,
                            imageWidth: 352,
                            imageHeight: 285,
                        }
                    ).then(function(webcamPhotoSnapper){
                        me.pending = false
                        me.webcamPhotoSnapper = webcamPhotoSnapper
                        me.webcamError = ''
                    }).catch(function(err){
                        me.webcamError = err.message;

                        if (err.name == "NotFoundError" || err.name == "DevicesNotFoundError") {
                            //required track is missing 
                            me.webcamError += '. Please check if you have a camera.';

                        } else if (err.name == "NotReadableError" || err.name == "TrackStartError") {
                            //webcam or mic are already in use 
                            me.webcamError += '. Please close the other app that is using the camera';
                      
                        } else if (err.name == "NotAllowedError" || err.name == "PermissionDeniedError") {
                            //permission denied in browser 
                            me.webcamError += '. Please allow HRIS to use your camera.';
                            
                        }

                    }).then(function(){
                        me.pending = false
                    })
                }
            },
            webcamPause: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    document.getElementById("webcam-feed").pause()
                }
            },
            webcamSnap: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    me.webcamPhoto = me.webcamPhotoSnapper.snap()
                }
            },
            webcamStop: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    me.webcamPhotoSnapper.stop()
                    me.webcamPhotoSnapper = null
                }
            }
        }
    });
</script>
{# https://obfuscator.io/ #}
{# <script>
    function _0x1018(_0x6f7038,_0xb087d6){var _0x4eca9d=_0x4eca();return _0x1018=function(_0x1018d8,_0x4c80cf){_0x1018d8=_0x1018d8-0x110;var _0x1054c0=_0x4eca9d[_0x1018d8];return _0x1054c0;},_0x1018(_0x6f7038,_0xb087d6);}function _0x4eca(){var _0x246657=['webcamLoaded','You\x20must\x20allow\x20this\x20permission\x20\x0ato\x20use\x20the\x20service:\x20\x0aPermissions\x20>\x20Location\x20>\x20Allow\x0aOtherwise,\x20you\x20can\x20go\x20to\x20one\x20of\x20our\x20scanner\x20to\x20log.','Morning\x20In','hh:mm\x20A','TrackStartError','stop','startTimer','Morning\x20Out','locationMessage','loadMap','1290180vQOowS','latLon','webcamPhotoSnapper','Unknown\x20error.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.','polygon','getItem','loadedmetadata','dontme','Mosqueda\x20Campus\x20Boundaries','error','getCurrentPosition','bindPopup','icon','Location\x20failed.\x20Please\x20try\x20again\x20later\x20or\x20go\x20to\x20the\x20scanner\x20to\x20log.','webcamSnap','name','slide.bs.carousel','addTo','webcamError','nextLogCheckPoint','disable','webcam-snapshot','NotAllowedError','map','Your\x20Location!','https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia29zaW5peCIsImEiOiJjamFsd2t3Y3QydW05MzNxdXUyeWV6azhoIn0.aqHKe7JGKQrNMD5-WP8xDQ','\x20is\x20not\x20allowed\x20online.\x20Please\x20use\x20our\x20scanners.','addEventListener','detectLocation','NotReadableError','Baterna\x20Campus\x20Boundaries','log','createWebcamPhotoSnapper','.\x20Please\x20allow\x20HRIS\x20to\x20use\x20your\x20camera.','1070fEeFSW','webcamStop','mapLocationErrorMode','countdown','msg','mapMarker','.\x20Please\x20check\x20if\x20you\x20have\x20a\x20camera.','time','location','post','/online','Your\x20are\x20inside\x20','23928YxjSjK','getElementById','#carousel-map','catch','The\x20request\x20was\x20made\x20but\x20no\x20response\x20was\x20received','PermissionDeniedError','webcamPhoto','Your\x20browser\x20does\x20not\x20support\x20the\x20online\x20time-in/time-out.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.','763758sIPjAz','currentLogCheckPoint','request','255016QcDRIf','marker','scrollWheelZoom','validationMixin','code','message','checkPoint','8818872GUbyKQ','green','webcam-feed','Something\x20happened\x20in\x20setting\x20up\x20the\x20request\x20that\x20triggered\x20an\x20Error.','navigator.geolocation','setView','Salvador\x20Campus\x20Boundaries','pause','removeLayer','href','mapbox/streets-v11','get','mapLocationResultName','/e-profile/dtr/','page','387928wrJAIu','then','2896558aCciNz','latLon.0','#vApp','pending','Extended\x20In','hrisOnlineLogFirstRun','Asia/Manila','snap','data','/location','setItem','/log-point','/logs','response','Afternoon\x20Out','XMLHttpRequest','Extended\x20Out'];_0x4eca=function(){return _0x246657;};return _0x4eca();}var _0x160969=_0x1018;(function(_0x45c97e,_0x8f22f7){var _0x291abb=_0x1018,_0x2b6580=_0x45c97e();while(!![]){try{var _0x91a664=parseInt(_0x291abb(0x11d))/0x1+parseInt(_0x291abb(0x170))/0x2+-parseInt(_0x291abb(0x13a))/0x3+-parseInt(_0x291abb(0x173))/0x4+-parseInt(_0x291abb(0x15c))/0x5*(-parseInt(_0x291abb(0x168))/0x6)+parseInt(_0x291abb(0x11f))/0x7+-parseInt(_0x291abb(0x17a))/0x8;if(_0x91a664===_0x8f22f7)break;else _0x2b6580['push'](_0x2b6580['shift']());}catch(_0x165afa){_0x2b6580['push'](_0x2b6580['shift']());}}}(_0x4eca,0x6ba1c));var geo=_['get'](window,_0x160969(0x112)),initPage=0x0,firstRun=localStorage[_0x160969(0x13f)](_0x160969(0x124));firstRun&&(initPage=0x1);var countdownTimer=null,vApp=new Vue({'el':_0x160969(0x121),'delimiters':['${','}'],'mixins':[window['vuelidate'][_0x160969(0x176)],window['vuelidateExtendMixin']],'data':{'pending':![],'page':0x0,'latLon':[],'map':null,'mapMarker':null,'mapLocationErrorMode':0x0,'mapLocationResultName':'','locationMessage':'','webcamPhotoSnapper':null,'webcamLoaded':![],'webcamPhoto':'','webcamError':'','time':'','countdown':0x14,'dontme':0x0,'currentLogCheckPoint':0x0},'validations':{},'created':function(){var _0x47da4b=_0x160969;this[_0x47da4b(0x11c)]=initPage;},'computed':{'nextLogCheckPoint':function(){var _0x4d0ec3=_0x160969;if(this[_0x4d0ec3(0x171)]===0x0)return _0x4d0ec3(0x132);else{if(this[_0x4d0ec3(0x171)]===0x1)return _0x4d0ec3(0x137);else{if(this[_0x4d0ec3(0x171)]===0x2)return'Afternoon\x20In';else{if(this[_0x4d0ec3(0x171)]===0x3)return _0x4d0ec3(0x12d);else{if(this[_0x4d0ec3(0x171)]===0x4)return _0x4d0ec3(0x123);else{if(this[_0x4d0ec3(0x171)]===0x5)return _0x4d0ec3(0x12f);}}}}}}},'mounted':function(){var _0x1e5439=_0x160969,_0x1720ff=this;document['getElementById']('webcam-feed')[_0x1e5439(0x155)](_0x1e5439(0x140),function(_0x3f25dd){var _0x3d1ab8=_0x1e5439;_0x1720ff[_0x3d1ab8(0x130)]=!![];}),jQuery(_0x1e5439(0x16a))['on'](_0x1e5439(0x14a),function(_0x17ccb7){var _0x255f2f=_0x1e5439;_0x1720ff[_0x255f2f(0x11c)]=_0x17ccb7['to'];}),setInterval(function(){var _0x1c93d5=_0x1e5439;_0x1720ff[_0x1c93d5(0x163)]=moment['tz'](_0x1c93d5(0x125))['format'](_0x1c93d5(0x133));},0x3e8);},'watch':{'page':function(_0x213991,_0xfba45e){var _0x15a242=_0x160969,_0x6fb863=this;jQuery('#carousel-map')['carousel'](_0x213991);if(_0x213991===0x0){}else{if(_0x213991===0x1)_0x6fb863[_0x15a242(0x141)]&&localStorage[_0x15a242(0x129)](_0x15a242(0x124),!![]),_0x6fb863[_0x15a242(0x15d)]();else{if(_0x213991===0x2)_0x6fb863[_0x15a242(0x139)](),_0x6fb863[_0x15a242(0x156)]();else{if(_0x213991===0x3)_0x6fb863['webcamStart'](),_0x6fb863['loadLogPoint']();else{if(_0x213991===0x4){}}}}}}},'methods':{'startTimer':function(){var _0x2f63fb=_0x160969,_0x4ceb4b=this;countdownTimer&&(clearInterval(countdownTimer),_0x4ceb4b[_0x2f63fb(0x15f)]=0x14),countdownTimer=setInterval(function(){var _0xfef48=_0x2f63fb;_0x4ceb4b[_0xfef48(0x15f)]-=0x1,_0x4ceb4b['countdown']<=0x0&&(clearInterval(countdownTimer),_0x4ceb4b[_0xfef48(0x122)]=!![],_0x4ceb4b[_0xfef48(0x159)]());},0x3e8);},'log':function(){var _0x6152ba=_0x160969,_0x2adb3e=this;_0x2adb3e[_0x6152ba(0x122)]=!![];let _0x1fce22=0x1;if(this[_0x6152ba(0x171)]===0x0)_0x1fce22=0x1;else{if(this[_0x6152ba(0x171)]===0x1)_0x1fce22=0x0;else{if(this[_0x6152ba(0x171)]===0x2)_0x1fce22=0x1;else{if(this['currentLogCheckPoint']===0x3)_0x1fce22=0x0;else{if(this['currentLogCheckPoint']===0x4)_0x1fce22=0x1;else this['currentLogCheckPoint']===0x5&&(_0x1fce22=0x0);}}}}var _0x506434={'mode':_0x1fce22,'webcamPhoto':_0x2adb3e['webcamPhoto'],'lat':_[_0x6152ba(0x119)](_0x2adb3e,_0x6152ba(0x120)),'lon':_[_0x6152ba(0x119)](_0x2adb3e,'latLon.1')};axios['post'](_0x6152ba(0x11b)+employmentId+_0x6152ba(0x12b),_0x506434,{'headers':{'X-Requested-With':_0x6152ba(0x12e)}})[_0x6152ba(0x11e)](function(_0x4f0356){var _0x334000=_0x6152ba,_0x1e8ce7=_[_0x334000(0x119)](_0x4f0356,_0x334000(0x127));window[_0x334000(0x164)][_0x334000(0x117)]=_0x334000(0x11b)+employmentId+'';})['catch'](function(_0x5c9ca8){var _0x15f379=_0x6152ba;if(_0x5c9ca8[_0x15f379(0x12c)]){var _0x188d2d=_0x5c9ca8['response'][_0x15f379(0x127)];console[_0x15f379(0x143)](_0x188d2d),alert(_0x188d2d[_0x15f379(0x160)]);}else{if(_0x5c9ca8['request']){var _0x16dbd9=_0x15f379(0x16c);console[_0x15f379(0x143)](_0x16dbd9);}else{var _0x16dbd9=_0x15f379(0x111);console[_0x15f379(0x143)](_0x16dbd9,_0x5c9ca8[_0x15f379(0x178)]);}}_0x2adb3e[_0x15f379(0x122)]=![],window[_0x15f379(0x164)]['href']=_0x15f379(0x11b)+employmentId+_0x15f379(0x166);})[_0x6152ba(0x11e)](function(){});},'snap':function(){var _0x39ec88=_0x160969;this[_0x39ec88(0x148)](),this[_0x39ec88(0x136)]();},'detectLocation':function(){var _0x3eb415=_0x160969,_0x33eeac=this;!geo?alert(_0x3eb415(0x16f)):(_0x33eeac[_0x3eb415(0x122)]=!![],geo[_0x3eb415(0x144)](function(_0x44f059){var _0x28d25a=_0x3eb415;let _0x5edc2e=_[_0x28d25a(0x119)](_0x44f059,'coords.latitude'),_0x3b97fd=_[_0x28d25a(0x119)](_0x44f059,'coords.longitude'),_0x3a58b7={'coordinates':[_0x3b97fd,_0x5edc2e]};_0x33eeac[_0x28d25a(0x151)][_0x28d25a(0x113)]([_0x5edc2e,_0x3b97fd],0x11);var _0x2aa029=L[_0x28d25a(0x146)]({'iconUrl':'/images/marker-1.png','iconSize':[0x21,0x32],'shadowSize':[0x32,0x40],'iconAnchor':[16.5,0x32]});_0x33eeac['mapMarker']&&_0x33eeac['map'][_0x28d25a(0x116)](_0x33eeac[_0x28d25a(0x161)]),_0x33eeac[_0x28d25a(0x161)]=L[_0x28d25a(0x174)]([_0x5edc2e,_0x3b97fd],{'icon':_0x2aa029})[_0x28d25a(0x145)](_0x28d25a(0x152))[_0x28d25a(0x14b)](_0x33eeac[_0x28d25a(0x151)]),axios[_0x28d25a(0x165)](_0x28d25a(0x11b)+employmentId+_0x28d25a(0x128),_0x3a58b7,{'headers':{'X-Requested-With':_0x28d25a(0x12e)}})['then'](function(_0x3568e4){var _0x36152c=_0x28d25a,_0x4f58ec=_['get'](_0x3568e4,_0x36152c(0x127));console[_0x36152c(0x159)](_0x4f58ec),_0x33eeac[_0x36152c(0x15e)]=0x0,_0x33eeac[_0x36152c(0x11a)]=_0x4f58ec,_0x33eeac[_0x36152c(0x13b)]=[_0x5edc2e,_0x3b97fd],_0x33eeac[_0x36152c(0x138)]=_0x36152c(0x167)+_0x4f58ec+'.';})[_0x28d25a(0x16b)](function(_0x555230){var _0x15bfc0=_0x28d25a;if(_0x555230[_0x15bfc0(0x12c)]){var _0x3afbe2=_0x555230[_0x15bfc0(0x12c)][_0x15bfc0(0x127)];console[_0x15bfc0(0x143)](_0x3afbe2);}else{if(_0x555230[_0x15bfc0(0x172)]){var _0x376c15=_0x15bfc0(0x16c);console[_0x15bfc0(0x143)](_0x376c15);}else{var _0x376c15=_0x15bfc0(0x111);console[_0x15bfc0(0x143)](_0x376c15,_0x555230['message']);}}_0x33eeac['mapLocationResultName']='',_0x33eeac[_0x15bfc0(0x15e)]=0x1,_0x33eeac[_0x15bfc0(0x13b)]=[_0x5edc2e,_0x3b97fd],_0x33eeac[_0x15bfc0(0x138)]='',_0x33eeac[_0x15bfc0(0x122)]=![];})[_0x28d25a(0x11e)](function(){var _0x57aa65=_0x28d25a;_0x33eeac[_0x57aa65(0x122)]=![];});},function(_0x23467b){var _0x120715=_0x3eb415,_0x3003bf=_[_0x120715(0x119)](_0x23467b,_0x120715(0x177),0x0),_0x36bdb4='';if(_0x3003bf===0x1)_0x33eeac[_0x120715(0x15e)]=0x2,_0x36bdb4=_0x120715(0x131);else{if(_0x3003bf===0x2)_0x33eeac[_0x120715(0x15e)]=0x3,_0x36bdb4='Service\x20currently\x20unavailable.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.';else _0x3003bf===0x3?(_0x33eeac[_0x120715(0x15e)]=0x4,_0x36bdb4=_0x120715(0x147)):_0x36bdb4=_0x120715(0x13d);}_0x33eeac[_0x120715(0x122)]=![];},{'timeout':0x1388,'enableHighAccuracy':!![]}));},'loadLogPoint':function(){var _0x1e9ed8=_0x160969,_0x3a0d6b=this;_0x3a0d6b[_0x1e9ed8(0x122)]=!![],axios[_0x1e9ed8(0x119)](_0x1e9ed8(0x11b)+employmentId+_0x1e9ed8(0x12a),{'headers':{'X-Requested-With':'XMLHttpRequest'}})['then'](function(_0x3b3444){var _0x352bcc=_0x1e9ed8,_0x4d55b5=_[_0x352bcc(0x119)](_0x3b3444,_0x352bcc(0x127));_0x3a0d6b['currentLogCheckPoint']=_[_0x352bcc(0x119)](_0x4d55b5,_0x352bcc(0x179),0x0);if(_0x3a0d6b[_0x352bcc(0x171)]===0x1||_0x3a0d6b['currentLogCheckPoint']===0x2){}else _0x3a0d6b[_0x352bcc(0x122)]=![],alert(_0x3a0d6b[_0x352bcc(0x14d)]+_0x352bcc(0x154)),window[_0x352bcc(0x164)][_0x352bcc(0x117)]=_0x352bcc(0x11b)+employmentId+'';})[_0x1e9ed8(0x16b)](function(_0x2083c6){var _0xe240f0=_0x1e9ed8;if(_0x2083c6['response']){var _0x165a4d=_0x2083c6[_0xe240f0(0x12c)][_0xe240f0(0x127)];console[_0xe240f0(0x143)](_0x165a4d);}else{if(_0x2083c6[_0xe240f0(0x172)]){var _0x1f9d6d=_0xe240f0(0x16c);console[_0xe240f0(0x143)](_0x1f9d6d);}else{var _0x1f9d6d='Something\x20happened\x20in\x20setting\x20up\x20the\x20request\x20that\x20triggered\x20an\x20Error.';console[_0xe240f0(0x143)](_0x1f9d6d,_0x2083c6[_0xe240f0(0x178)]);}}_0x3a0d6b[_0xe240f0(0x122)]=![];})[_0x1e9ed8(0x11e)](function(){var _0x3e4cb2=_0x1e9ed8;_0x3a0d6b[_0x3e4cb2(0x122)]=![];});},'loadMap':function(){var _0x2f79d5=_0x160969,_0x3590ac=this;if(!_0x3590ac[_0x2f79d5(0x151)])_0x3590ac['map']=L[_0x2f79d5(0x151)](_0x2f79d5(0x151));else return;var _0x4fc66b=_0x3590ac[_0x2f79d5(0x151)];_0x4fc66b[_0x2f79d5(0x113)]([10.69951,122.65067],0xf),_0x4fc66b[_0x2f79d5(0x175)][_0x2f79d5(0x14e)]();var _0x11f7e6=L['tileLayer'](_0x2f79d5(0x153),{'maxZoom':0x12,'attribution':'Developed\x20by\x20the\x20<a\x20target=\x22_blank\x22\x20href=\x22https://mis.gsc.edu.ph\x22>MIS</a>.','id':_0x2f79d5(0x118),'tileSize':0x200,'zoomOffset':-0x1})[_0x2f79d5(0x14b)](_0x4fc66b),_0xb25f7b=L[_0x2f79d5(0x13e)]([[10.6990108,122.6498571],[10.6980449,122.6508093],[10.6984059,122.6512063],[10.6984389,122.6511741],[10.6984883,122.651223],[10.6984369,122.6512827],[10.6991795,122.652086],[10.7000703,122.6511459],[10.7003233,122.6508602],[10.7007516,122.650305],[10.6998568,122.6493314],[10.6991544,122.650006],[10.6990108,122.6498571]],{'color':'green'})[_0x2f79d5(0x145)](_0x2f79d5(0x114));_0xb25f7b[_0x2f79d5(0x14b)](_0x4fc66b),_0xb25f7b=L[_0x2f79d5(0x13e)]([[10.6194448,122.5937879],[10.6188743,122.5976385],[10.6177542,122.5970157],[10.6181925,122.5933632],[10.6194448,122.5937879]],{'color':_0x2f79d5(0x17b)})['bindPopup'](_0x2f79d5(0x142)),_0xb25f7b[_0x2f79d5(0x14b)](_0x4fc66b),_0xb25f7b=L[_0x2f79d5(0x13e)]([[10.5838882,122.6716331],[10.5839687,122.6713986],[10.5842046,122.6711531],[10.5843011,122.6711203],[10.5837542,122.6705312],[10.5830785,122.6699584],[10.5828909,122.6699966],[10.5824511,122.6706458],[10.5824029,122.6707549],[10.5838882,122.6716331]],{'color':_0x2f79d5(0x17b)})[_0x2f79d5(0x145)](_0x2f79d5(0x158)),_0xb25f7b[_0x2f79d5(0x14b)](_0x4fc66b);},'webcamStart':function(){var _0x51f8fd=_0x160969,_0xbcd140=this;!_0xbcd140[_0x51f8fd(0x13c)]&&(_0xbcd140['pending']=!![],MediaDevicesPresets[_0x51f8fd(0x15a)](document[_0x51f8fd(0x169)]('webcam-feed'),document[_0x51f8fd(0x169)](_0x51f8fd(0x14f)),{'width':0x160,'height':0x11d,'imageWidth':0x160,'imageHeight':0x11d})[_0x51f8fd(0x11e)](function(_0x533edc){var _0x339336=_0x51f8fd;_0xbcd140[_0x339336(0x122)]=![],_0xbcd140[_0x339336(0x13c)]=_0x533edc,_0xbcd140[_0x339336(0x14c)]='';})['catch'](function(_0xf606f){var _0xc364d9=_0x51f8fd;_0xbcd140[_0xc364d9(0x14c)]=_0xf606f['message'];if(_0xf606f[_0xc364d9(0x149)]=='NotFoundError'||_0xf606f[_0xc364d9(0x149)]=='DevicesNotFoundError')_0xbcd140[_0xc364d9(0x14c)]+=_0xc364d9(0x162);else{if(_0xf606f[_0xc364d9(0x149)]==_0xc364d9(0x157)||_0xf606f[_0xc364d9(0x149)]==_0xc364d9(0x134))_0xbcd140[_0xc364d9(0x14c)]+='.\x20Please\x20close\x20the\x20other\x20app\x20that\x20is\x20using\x20the\x20camera';else(_0xf606f[_0xc364d9(0x149)]==_0xc364d9(0x150)||_0xf606f[_0xc364d9(0x149)]==_0xc364d9(0x16d))&&(_0xbcd140[_0xc364d9(0x14c)]+=_0xc364d9(0x15b));}})[_0x51f8fd(0x11e)](function(){_0xbcd140['pending']=![];}));},'webcamPause':function(){var _0x51fe74=_0x160969,_0x58c18e=this;_0x58c18e[_0x51fe74(0x13c)]&&document['getElementById'](_0x51fe74(0x110))[_0x51fe74(0x115)]();},'webcamSnap':function(){var _0x17faa6=_0x160969,_0x10ffc0=this;_0x10ffc0[_0x17faa6(0x13c)]&&(_0x10ffc0[_0x17faa6(0x16e)]=_0x10ffc0[_0x17faa6(0x13c)][_0x17faa6(0x126)]());},'webcamStop':function(){var _0x3a1031=_0x160969,_0x13b4e6=this;_0x13b4e6[_0x3a1031(0x13c)]&&(_0x13b4e6['webcamPhotoSnapper'][_0x3a1031(0x135)](),_0x13b4e6[_0x3a1031(0x13c)]=null);}}});
</script> #}
{% endblock %}

