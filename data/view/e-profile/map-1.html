{% extends "document.html" %}
{% block styles %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="   crossorigin=""/>
{% endblock %}

{% block body %}
<div class="col-md-12" id="vApp" v-cloak v-bind:data-pending="pending">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <div class="d-flex align-items-start">
            <h1 class="h4 h3-md">Online Log Verification</h1>
        </div>
        <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group mr-2">
                <a href="/e-profile/home" class="btn btn-sm btn-outline-primary">Back</a>
            </div>
        </div>
    </div>
    <div class="mb-5 tab-content p-3">
        <div id="carousel-map" class="carousel slide" data-ride="carousel" data-touch="false" data-interval="false">
            {# <ol class="carousel-indicators">
                <li data-target="#carousel-map" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-map" data-slide-to="1"></li>
                <li data-target="#carousel-map" data-slide-to="2"></li>
                <li data-target="#carousel-map" data-slide-to="3"></li>
            </ol> #}
            <div class="carousel-inner p-3">
                {# 1 #}
                <div class="carousel-item active">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <img src="/images/phone-loc2.jpg" alt="">
                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-left">
                            <div class="col-lg-6">
                                <h1 class="h2 mb-5 text-center text-md-left">Before You Begin...</h1>
                                <p>We encourage you to use your mobile phone for a smoother log transaction.</p>
                                <p>Your device must have a camera.</p>
                                <p>You must allow HRIS to use your device location and camera.</p>
                                <p>A desktop or laptop computer can be used but the location services might not work properly.</p>
                                <p>How your location and photos are used is detailed in our Data Privacy statement.</p>
                                <div class="form-check pt-3">
                                        <input v-model="dontme" class="form-check-input" type="checkbox" value="1" id="dontme">
                                        <label class="form-check-label" for="dontme">
                                            Do not show again
                                        </label>
                                    </div>
                                <div class="text-center pt-3">
                                    
                                    <button v-on:click="page=2-1" type="button" class="btn btn-full-width btn-primary">Understood. Let's Start! </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 2 #}
                <div class="carousel-item">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <img src="/images/phone-loc.jpg" alt="">
                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-6">
                                <h1 class="h2 mb-5">Verify Location</h1>
                                <p>We need to verify that you are within the school campus.</p>
                                <div class="text-center pt-5">
                                    <button v-on:click="page=3-1" type="button" class="btn btn-full-width btn-primary">Detect Location</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 3 #}
                <div class="carousel-item ">
                    <div class="row">
                        <div class="col-md-7 text-center text-md-right pt-5 pb-5">
                            <div id="map" style="height:300px"></div>
                        </div>
                        <div class="col-md-5 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-9">
                                <h1 v-if="mapLocationErrorMode === 0" class="h2 mb-5">Location Verified</h1>
                                <h1 v-else class="h2 mb-5">Location Result</h1>
                                <div v-if="mapLocationErrorMode === 0">
                                    <p>You are inside ${mapLocationResultName}.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 1" class="text-left">
                                    <p>Unfortunately, your detected location is outside of our school. </p>
                                    <p>If you think this is inaccurate, please try any of the following: </p>
                                    <ul>
                                        <li>Use your phone</li>
                                        <li>Connect with mobile data</li>
                                        <li>Enable GPS</li>
                                    </ul>
                                </div>
                                <div v-if="mapLocationErrorMode === 2">
                                    <p>You did not allow HRIS to get your location.</p>
                                    <p>Please go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 3">
                                    <p>Service currently unavailable. Please go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 4">
                                    <p>Location service failed. Please try again later or go to one of our scanners to log.</p>
                                </div>
                                <div v-if="mapLocationErrorMode === 5">
                                    <p>Unknown error. Please go to one of our scanners to log.</p>
                                </div>

                                <div class="text-center pt-5">
                                    <button v-if="mapLocationErrorMode===0" v-on:click="page=4-1" type="button" class="btn btn-full-width btn-primary">Next</button>
                                    <template v-else>
                                        <button v-on:click="detectLocation" type="button" class="btn btn-full-width btn-primary mb-3">Try Again</button>
                                        <a href="/e-profile/dtr/{{employment._id}}" class="btn btn-light btn-full-width">I'll just go to the scanner.</a>
                                    </template>    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# 4 #}
                <div class="carousel-item ">
                    <div class="row">
                        <div class="col-md-5 text-center text-md-right pt-5 pb-5">
                            <div style="position: relative; width: 245px; height: 500px; display:inline-block;">
                                <div style="position: absolute; left: 15px; top:62px; width: 215px; height:285px; overflow: hidden;">
                                <img v-if="webcamPhoto" style="position: absolute; left:-50%; top:0; z-index:5; height:100%;" v-bind:src="webcamPhoto" alt="photo">
                                <video id="webcam-feed" style="position: absolute; left:-50%; top: 0;"></video>
                                <canvas id="webcam-snapshot"></canvas>
                                </div>
                                <img src="/images/phone-cam.jpg" alt="">
                            </div>

                        </div>
                        <div class="col-md-7 pt-md-5 pb-5 text-center text-md-left">
                            <div class="col-lg-6">
                                <h1 v-if="!webcamPhoto" class="h2 mb-5">Identity Verification</h1>
                                <h1 v-else class="h2 mb-5">Ready to Submit</h1>

                                <div v-if="webcamError">
                                    <p>${webcamError}</p>
                                    <div class="text-center pt-5">
                                        <button v-on:click="webcamStart" type="button" class="btn btn-full-width btn-primary">Try Again</button>
                                    </div>
                                </div>
                                <div v-else>
                                    <div v-if="!webcamPhoto">
                                        <p>We need to know its you. Please take a selfie.</p>
                                    </div>
                                    <div v-else>
                                        <p>${nextLogCheckPoint}: ${time} <br>
                                        Location: ${mapLocationResultName}</p>
                                    </div>
                                   
                                    <div class="text-center">
                                        <button v-if="!webcamPhoto" v-on:click="snap" type="button" class="mt-5 btn btn-full-width btn-primary">Take Selfie</button>
                                        <div v-else>
                                            <div style="font-size:12px" class="alert alert-warning text-left mb-2 mt-2">
                                                Warning: Under the Civil Service Commission, the falsification of DTRs would render the authors thereof administratively liable for Dishonesty and Grave Misconduct. <br><br>
                                                Punishment may range from suspension to dismissal.
                                            </div>
                                            <button v-on:click="log" type="button" class="btn btn-full-width btn-primary">Submit Attendance to HR (${countdown})</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="{{app.url}}/js/axios.min.js"></script>
<script src="{{app.url}}/js/media-devices.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="   crossorigin=""></script>
<script>
    var employmentId = '{{employment._id}}';
    var employeeId = '{{employee._id}}';
</script>
{# <script>

    var geo = _.get(window, 'navigator.geolocation');
    var initPage = 0
    var firstRun = localStorage.getItem('hrisOnlineLogFirstRun');
    if(firstRun){
        initPage = 1
    }

    var countdownTimer = null;
    var vApp = new Vue({
        el: '#vApp',
        delimiters: ["${", "}"],
        mixins: [
            window.vuelidate.validationMixin,
            window.vuelidateExtendMixin,
        ],
        data: {
            pending: false,
            page: 0,
            latLon: [],
            map: null,
            mapMarker: null,
            mapLocationErrorMode: 0,
            mapLocationResultName: '',
            locationMessage: '',

            webcamPhotoSnapper: null,
            webcamLoaded: false,
            webcamPhoto: '',
            webcamError: '',

            time: '',
            countdown: 20,
            dontme: 0,
            currentLogCheckPoint: 0,
        },
        validations: {
            
        },
        created: function(){
            this.page = initPage
        },
        computed: {
            nextLogCheckPoint: function(){
                if(this.currentLogCheckPoint === 0){
                    return 'Morning In'
                } else if(this.currentLogCheckPoint === 1){
                    return 'Morning Out'
                } else if(this.currentLogCheckPoint === 2){
                    return 'Afternoon In'
                } else if(this.currentLogCheckPoint === 3){
                    return 'Afternoon Out'
                } else if(this.currentLogCheckPoint === 4){
                    return 'Extended In'
                } else if(this.currentLogCheckPoint === 5){
                    return 'Extended Out'
                }
            }
        },
        mounted: function(){

            var me = this;

            document.getElementById("webcam-feed").addEventListener('loadedmetadata', function(e){
                me.webcamLoaded = true
            })

            jQuery('#carousel-map').on('slide.bs.carousel', function (e) {
                me.page = e.to
            })

            setInterval(function(){
                me.time = moment.tz('Asia/Manila').format('hh:mm A')
            }, 1000)

            
        },
        watch: {
            page: function (newPage, oldPage) {
                var me = this;
                jQuery('#carousel-map').carousel(newPage)
                
                if(newPage === 0) { // 1

                } else if(newPage === 1) { // 2
                    if(me.dontme){
                        localStorage.setItem('hrisOnlineLogFirstRun', true);
                    }
                    me.webcamStop()

                } else if(newPage ===2) { // 3
                    me.loadMap()
                    me.detectLocation()
                    
                } else if(newPage === 3) { // 4
                    me.webcamStart()
                    me.loadLogPoint()

                } else if(newPage === 4) { // 5
                    

                }
            }
        },
        methods: {
            startTimer: function(){
                var me = this;
                if(countdownTimer){
                    clearInterval(countdownTimer)
                    me.countdown = 20
                }
                countdownTimer = setInterval(function(){
                    me.countdown -= 1
                    if(me.countdown <= 0) {
                        clearInterval(countdownTimer)
                        me.pending = true
                        me.log()
                    }
                }, 1000)
            },
            log: function(){
                var me = this;
                me.pending = true;

                let logType = 1
                if(this.currentLogCheckPoint === 0){
                    logType = 1
                } else if(this.currentLogCheckPoint === 1){
                    logType = 0
                } else if(this.currentLogCheckPoint === 2){
                    logType = 1
                } else if(this.currentLogCheckPoint === 3){
                    logType = 0
                } else if(this.currentLogCheckPoint === 4){
                    logType = 1
                } else if(this.currentLogCheckPoint === 5){
                    logType = 0
                }

                var body = {
                    mode: logType,
                    webcamPhoto: me.webcamPhoto,
                    lat: _.get(me, 'latLon.0'),
                    lon: _.get(me, 'latLon.1'),
                };

                axios.post('/e-profile/dtr/' + employmentId + '/logs', body, {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                    var data = _.get(response, 'data')
                    window.location.href = '/e-profile/dtr/' + employmentId + '';
                }).catch(function (error) {
                    if (error.response) {
                        // Request made, server responded with a status code outside of 2xx
                        // console.error(error.response.status)
                        var err = error.response.data;
                        console.error(err)
                        alert(err.msg)

                    } else if (error.request) {
                        var msg = 'The request was made but no response was received'
                        console.error(msg);

                    } else {
                        var msg = 'Something happened in setting up the request that triggered an Error.'
                        console.error(msg, error.message);

                    }
                    me.pending = false;
                    window.location.href = '/e-profile/dtr/' + employmentId + '/online';
                }).then(function () {
                })
            },
            snap: function(){
                this.webcamSnap()
                this.startTimer()
            },
            detectLocation: function(){
                var me = this;

                if (!geo) {
                    alert("Your browser does not support the online time-in/time-out. Please go to the scanner to log.");
                } else { 

                    me.pending = true;

                    geo.getCurrentPosition(
                        function(location){  
                            let lat = _.get(location, 'coords.latitude');
                            let lon = _.get(location, 'coords.longitude');

                            /*
                            // mosqueda
                            lat = 10.61821
                            lon = 122.59340

                            // baterna
                            lat = 10.58386
                            lon = 122.67105 

                            // salvador
                            lat = 10.69994
                            lon = 122.65108  
                            */

                            let body = {
                                coordinates: [lon, lat],
                            }

                            me.map.setView([lat, lon], 17);
                            var pin = L.icon({
                                iconUrl: '/images/marker-1.png',
                                iconSize:     [33, 50], // size of the icon
                                shadowSize:   [50, 64], // size of the shadow
                                iconAnchor:   [16.5, 50], // point of the icon which will correspond to marker's location
                            });

                            if(me.mapMarker){
                                me.map.removeLayer(me.mapMarker)
                            }
                            me.mapMarker = L.marker([lat, lon], {icon: pin}).bindPopup("Your Location!").addTo(me.map);

                            axios.post('/e-profile/dtr/' + employmentId + '/location', body, {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                                var data = _.get(response, 'data')
                                console.log(data)
                                me.mapLocationErrorMode = 0
                                me.mapLocationResultName = data
                                me.latLon = [lat, lon]
                                me.locationMessage = 'Your are inside ' + data + '.'

                            }).catch(function (error) {
                                if (error.response) {
                                    // Request made, server responded with a status code outside of 2xx
                                    // console.error(error.response.status)
                                    var err = error.response.data;
                                    console.error(err)

                                } else if (error.request) {
                                    var msg = 'The request was made but no response was received'
                                    console.error(msg);

                                } else {
                                    var msg = 'Something happened in setting up the request that triggered an Error.'
                                    console.error(msg, error.message);

                                }

                                me.mapLocationResultName = ''
                                me.mapLocationErrorMode = 1
                                me.latLon = [lat, lon]
                                me.locationMessage = ''

                                me.pending = false;

                            }).then(function(){
                                me.pending = false;
                            })

                        }, 
                        function(positionError) {

                            var code = _.get(positionError, 'code', 0)
                            
                            var err = ''
                            if (code === 1) { // PERMISSION_DENIED
                                me.mapLocationErrorMode = 2
                                err = "You must allow this permission \nto use the service: \nPermissions > Location > Allow\nOtherwise, you can go to one of our scanner to log."
                            } else if (code === 2) { // POSITION_UNAVAILABLE
                                me.mapLocationErrorMode = 3
                                err = "Service currently unavailable. Please go to the scanner to log."
                            } else if (code === 3) { // TIMEOUT
                                me.mapLocationErrorMode = 4
                                err = "Location failed. Please try again later or go to the scanner to log."
                            } else {
                                err = "Unknown error. Please go to the scanner to log."
                            }


                            me.pending = false;

                        },
                        { 
                            timeout: 5000,
                            enableHighAccuracy: true
                        }
                    ); 

                }
            },
            loadLogPoint: function(){
                var me = this;
                me.pending = true;

                axios.get('/e-profile/dtr/' + employmentId + '/log-point', {headers: {'X-Requested-With': 'XMLHttpRequest'}}).then(function (response) {
                    var data = _.get(response, 'data')
                    me.currentLogCheckPoint = _.get(data, 'checkPoint', 0)
                    if(me.currentLogCheckPoint === 1 || me.currentLogCheckPoint === 2){

                    } else {
                        me.pending = false;

                        alert(me.nextLogCheckPoint+' is not allowed online. Please use our scanners.')
                        window.location.href = '/e-profile/dtr/' + employmentId + '';
                    }
                }).catch(function (error) {
                    if (error.response) {
                        // Request made, server responded with a status code outside of 2xx
                        // console.error(error.response.status)
                        var err = error.response.data;
                        console.error(err)

                    } else if (error.request) {
                        var msg = 'The request was made but no response was received'
                        console.error(msg);

                    } else {
                        var msg = 'Something happened in setting up the request that triggered an Error.'
                        console.error(msg, error.message);

                    }
                    me.pending = false;

                }).then(function () {
                    me.pending = false;
                })

            },
            loadMap: function(){
                var me = this;
                if(!me.map){
                    me.map = L.map('map');
                } else {
                    return ;
                }
                var map = me.map
                map.setView([10.69951, 122.65067], 15);
                map.scrollWheelZoom.disable();
                var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia29zaW5peCIsImEiOiJjamFsd2t3Y3QydW05MzNxdXUyeWV6azhoIn0.aqHKe7JGKQrNMD5-WP8xDQ', {
                    maxZoom: 18,
                    attribution: 'Developed by <a target="_blank" href="https://mis.gsc.edu.ph">MIS</a>. Map data by <a target="_blank" href="https://www.openstreetmap.org/copyright">OSM</a>. ' +
                        'Imagery by <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>.',
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1
                }).addTo(map);

                var polygon = L.polygon([
                    [10.6990108, 122.6498571],
                    [10.6980449, 122.6508093],
                    [10.6984059, 122.6512063],
                    [10.6984389, 122.6511741],
                    [10.6984883, 122.6512230],
                    [10.6984369, 122.6512827],
                    [10.6991795, 122.6520860],
                    [10.7000703, 122.6511459],
                    [10.7003233, 122.6508602],
                    [10.7007516, 122.6503050],
                    [10.6998568, 122.6493314],
                    [10.6991544, 122.6500060],
                    [10.6990108, 122.6498571],
                ], {color: 'green'}).bindPopup("Salvador Campus Boundaries");
                polygon.addTo(map);

                polygon = L.polygon([
                    [10.6194448, 122.5937879],
                    [10.6188743, 122.5976385],
                    [10.6177542, 122.5970157],
                    [10.6181925, 122.5933632],
                    [10.6194448, 122.5937879],
                ], {color: 'green'}).bindPopup("Mosqueda Campus Boundaries");
                polygon.addTo(map);

                polygon = L.polygon([
                    [10.5838882, 122.6716331],
                    [10.5839687, 122.6713986],
                    [10.5842046, 122.6711531],
                    [10.5843011, 122.6711203],
                    [10.5837542, 122.6705312],
                    [10.5830785, 122.6699584],
                    [10.5828909, 122.6699966],
                    [10.5824511, 122.6706458],
                    [10.5824029, 122.6707549],
                    [10.5838882, 122.6716331],
                ], {color: 'green'}).bindPopup("Baterna Campus Boundaries");
                polygon.addTo(map);
            },


            webcamStart: function(){
                var me = this
                if(!me.webcamPhotoSnapper){
                    me.pending = true
                    MediaDevicesPresets.createWebcamPhotoSnapper(
                        document.getElementById("webcam-feed"),
                        document.getElementById("webcam-snapshot"),
                        {
                            width: 352,
                            height: 285,
                            imageWidth: 352,
                            imageHeight: 285,
                        }
                    ).then(function(webcamPhotoSnapper){
                        me.pending = false
                        me.webcamPhotoSnapper = webcamPhotoSnapper
                        me.webcamError = ''
                    }).catch(function(err){
                        me.webcamError = err.message;

                        if (err.name == "NotFoundError" || err.name == "DevicesNotFoundError") {
                            //required track is missing 
                            me.webcamError += '. Please check if you have a camera.';

                        } else if (err.name == "NotReadableError" || err.name == "TrackStartError") {
                            //webcam or mic are already in use 
                            me.webcamError += '. Please close the other app that is using the camera';
                      
                        } else if (err.name == "NotAllowedError" || err.name == "PermissionDeniedError") {
                            //permission denied in browser 
                            me.webcamError += '. Please allow HRIS to use your camera.';
                            
                        }

                    }).then(function(){
                        me.pending = false
                    })
                }
            },
            webcamPause: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    document.getElementById("webcam-feed").pause()
                }
            },
            webcamSnap: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    me.webcamPhoto = me.webcamPhotoSnapper.snap()
                }
            },
            webcamStop: function(){
                var me = this
                if(me.webcamPhotoSnapper){
                    me.webcamPhotoSnapper.stop()
                    me.webcamPhotoSnapper = null
                }
            }
        }
    });
</script> #}
{# https://obfuscator.io/ #}
<script>
    var _0x3aae67=_0x5c39;(function(_0x462ff1,_0x15808f){var _0x307111=_0x5c39,_0xe97cf=_0x462ff1();while(!![]){try{var _0x45a172=-parseInt(_0x307111(0x21a))/0x1+-parseInt(_0x307111(0x22e))/0x2+-parseInt(_0x307111(0x1f0))/0x3+-parseInt(_0x307111(0x1e6))/0x4+parseInt(_0x307111(0x1f1))/0x5*(parseInt(_0x307111(0x22d))/0x6)+parseInt(_0x307111(0x20c))/0x7+-parseInt(_0x307111(0x1cc))/0x8*(-parseInt(_0x307111(0x1ec))/0x9);if(_0x45a172===_0x15808f)break;else _0xe97cf['push'](_0xe97cf['shift']());}catch(_0x50d188){_0xe97cf['push'](_0xe97cf['shift']());}}}(_0x1263,0x6fa4b));var geo=_[_0x3aae67(0x1f2)](window,_0x3aae67(0x230)),initPage=0x0,firstRun=localStorage[_0x3aae67(0x21c)](_0x3aae67(0x205));firstRun&&(initPage=0x1);var countdownTimer=null,vApp=new Vue({'el':'#vApp','delimiters':['${','}'],'mixins':[window[_0x3aae67(0x1eb)][_0x3aae67(0x1e4)],window['vuelidateExtendMixin']],'data':{'pending':![],'page':0x0,'latLon':[],'map':null,'mapMarker':null,'mapLocationErrorMode':0x0,'mapLocationResultName':'','locationMessage':'','webcamPhotoSnapper':null,'webcamLoaded':![],'webcamPhoto':'','webcamError':'','time':'','countdown':0x14,'dontme':0x0,'currentLogCheckPoint':0x0},'validations':{},'created':function(){this['page']=initPage;},'computed':{'nextLogCheckPoint':function(){var _0x5a44b4=_0x3aae67;if(this['currentLogCheckPoint']===0x0)return'Morning\x20In';else{if(this[_0x5a44b4(0x226)]===0x1)return _0x5a44b4(0x20d);else{if(this['currentLogCheckPoint']===0x2)return _0x5a44b4(0x1f6);else{if(this['currentLogCheckPoint']===0x3)return _0x5a44b4(0x1d2);else{if(this['currentLogCheckPoint']===0x4)return'Extended\x20In';else{if(this[_0x5a44b4(0x226)]===0x5)return _0x5a44b4(0x1ef);}}}}}}},'mounted':function(){var _0x243185=_0x3aae67,_0x52749b=this;document['getElementById'](_0x243185(0x208))[_0x243185(0x1d5)]('loadedmetadata',function(_0x1a0896){var _0x1f0c25=_0x243185;_0x52749b[_0x1f0c25(0x223)]=!![];}),jQuery('#carousel-map')['on']('slide.bs.carousel',function(_0x5195cb){var _0x1e92f6=_0x243185;_0x52749b[_0x1e92f6(0x21d)]=_0x5195cb['to'];}),setInterval(function(){var _0x49f571=_0x243185;_0x52749b['time']=moment['tz'](_0x49f571(0x1e7))[_0x49f571(0x1fe)](_0x49f571(0x218));},0x3e8);},'watch':{'page':function(_0x2be06b,_0x3f6255){var _0xac7942=_0x3aae67,_0x452353=this;jQuery(_0xac7942(0x209))[_0xac7942(0x1ff)](_0x2be06b);if(_0x2be06b===0x0){}else{if(_0x2be06b===0x1)_0x452353[_0xac7942(0x1f5)]&&localStorage[_0xac7942(0x1f7)]('hrisOnlineLogFirstRun',!![]),_0x452353['webcamStop']();else{if(_0x2be06b===0x2)_0x452353[_0xac7942(0x200)](),_0x452353[_0xac7942(0x213)]();else{if(_0x2be06b===0x3)_0x452353[_0xac7942(0x221)](),_0x452353[_0xac7942(0x1d1)]();else{if(_0x2be06b===0x4){}}}}}}},'methods':{'startTimer':function(){var _0x3a4888=_0x3aae67,_0x2bc212=this;countdownTimer&&(clearInterval(countdownTimer),_0x2bc212[_0x3a4888(0x204)]=0x14),countdownTimer=setInterval(function(){var _0x1446f5=_0x3a4888;_0x2bc212[_0x1446f5(0x204)]-=0x1,_0x2bc212[_0x1446f5(0x204)]<=0x0&&(clearInterval(countdownTimer),_0x2bc212[_0x1446f5(0x227)]=!![],_0x2bc212[_0x1446f5(0x1df)]());},0x3e8);},'log':function(){var _0x36d6ae=_0x3aae67,_0x3bc08f=this;_0x3bc08f[_0x36d6ae(0x227)]=!![];let _0x4c5fad=0x1;if(this[_0x36d6ae(0x226)]===0x0)_0x4c5fad=0x1;else{if(this[_0x36d6ae(0x226)]===0x1)_0x4c5fad=0x0;else{if(this[_0x36d6ae(0x226)]===0x2)_0x4c5fad=0x1;else{if(this[_0x36d6ae(0x226)]===0x3)_0x4c5fad=0x0;else{if(this[_0x36d6ae(0x226)]===0x4)_0x4c5fad=0x1;else this[_0x36d6ae(0x226)]===0x5&&(_0x4c5fad=0x0);}}}}var _0x330e7b={'mode':_0x4c5fad,'webcamPhoto':_0x3bc08f['webcamPhoto'],'lat':_[_0x36d6ae(0x1f2)](_0x3bc08f,'latLon.0'),'lon':_[_0x36d6ae(0x1f2)](_0x3bc08f,_0x36d6ae(0x1cf))};axios[_0x36d6ae(0x1d4)]('/e-profile/dtr/'+employmentId+_0x36d6ae(0x215),_0x330e7b,{'headers':{'X-Requested-With':_0x36d6ae(0x21e)}})[_0x36d6ae(0x1e9)](function(_0x195729){var _0x4c245a=_0x36d6ae,_0xe39cec=_[_0x4c245a(0x1f2)](_0x195729,'data');window[_0x4c245a(0x1e1)][_0x4c245a(0x222)]=_0x4c245a(0x1e3)+employmentId+'';})[_0x36d6ae(0x1d7)](function(_0x4e3d88){var _0x3eb847=_0x36d6ae;if(_0x4e3d88[_0x3eb847(0x1de)]){var _0x295851=_0x4e3d88[_0x3eb847(0x1de)][_0x3eb847(0x220)];console[_0x3eb847(0x231)](_0x295851),alert(_0x295851[_0x3eb847(0x1f4)]);}else{if(_0x4e3d88[_0x3eb847(0x1da)]){var _0x471a33=_0x3eb847(0x217);console[_0x3eb847(0x231)](_0x471a33);}else{var _0x471a33=_0x3eb847(0x1e8);console[_0x3eb847(0x231)](_0x471a33,_0x4e3d88[_0x3eb847(0x21f)]);}}_0x3bc08f[_0x3eb847(0x227)]=![],window[_0x3eb847(0x1e1)][_0x3eb847(0x222)]=_0x3eb847(0x1e3)+employmentId+_0x3eb847(0x22a);})[_0x36d6ae(0x1e9)](function(){});},'snap':function(){var _0x10224b=_0x3aae67;this[_0x10224b(0x1dc)](),this[_0x10224b(0x234)]();},'detectLocation':function(){var _0x1a5bd1=_0x3aae67,_0x50b779=this;!geo?alert(_0x1a5bd1(0x1d9)):(_0x50b779[_0x1a5bd1(0x227)]=!![],geo[_0x1a5bd1(0x22c)](function(_0x147977){var _0x275cf7=_0x1a5bd1;let _0x2ed0a9=_[_0x275cf7(0x1f2)](_0x147977,_0x275cf7(0x22b)),_0x44fd65=_[_0x275cf7(0x1f2)](_0x147977,'coords.longitude'),_0x3a2eb5={'coordinates':[_0x44fd65,_0x2ed0a9]};_0x50b779['map'][_0x275cf7(0x224)]([_0x2ed0a9,_0x44fd65],0x11);var _0x536762=L[_0x275cf7(0x1e5)]({'iconUrl':_0x275cf7(0x1ed),'iconSize':[0x21,0x32],'shadowSize':[0x32,0x40],'iconAnchor':[16.5,0x32]});_0x50b779['mapMarker']&&_0x50b779[_0x275cf7(0x20f)][_0x275cf7(0x1db)](_0x50b779[_0x275cf7(0x229)]),_0x50b779[_0x275cf7(0x229)]=L['marker']([_0x2ed0a9,_0x44fd65],{'icon':_0x536762})[_0x275cf7(0x20b)](_0x275cf7(0x216))['addTo'](_0x50b779[_0x275cf7(0x20f)]),axios[_0x275cf7(0x1d4)]('/e-profile/dtr/'+employmentId+_0x275cf7(0x1ee),_0x3a2eb5,{'headers':{'X-Requested-With':_0x275cf7(0x21e)}})[_0x275cf7(0x1e9)](function(_0x51ec5c){var _0x34ebfb=_0x275cf7,_0x314767=_[_0x34ebfb(0x1f2)](_0x51ec5c,_0x34ebfb(0x220));console[_0x34ebfb(0x1df)](_0x314767),_0x50b779[_0x34ebfb(0x210)]=0x0,_0x50b779[_0x34ebfb(0x1d8)]=_0x314767,_0x50b779['latLon']=[_0x2ed0a9,_0x44fd65],_0x50b779['locationMessage']=_0x34ebfb(0x201)+_0x314767+'.';})['catch'](function(_0x4d1c33){var _0x4ef285=_0x275cf7;if(_0x4d1c33[_0x4ef285(0x1de)]){var _0x41340b=_0x4d1c33['response'][_0x4ef285(0x220)];console[_0x4ef285(0x231)](_0x41340b);}else{if(_0x4d1c33[_0x4ef285(0x1da)]){var _0x136f88=_0x4ef285(0x217);console[_0x4ef285(0x231)](_0x136f88);}else{var _0x136f88='Something\x20happened\x20in\x20setting\x20up\x20the\x20request\x20that\x20triggered\x20an\x20Error.';console[_0x4ef285(0x231)](_0x136f88,_0x4d1c33[_0x4ef285(0x21f)]);}}_0x50b779[_0x4ef285(0x1d8)]='',_0x50b779[_0x4ef285(0x210)]=0x1,_0x50b779[_0x4ef285(0x1e2)]=[_0x2ed0a9,_0x44fd65],_0x50b779['locationMessage']='',_0x50b779[_0x4ef285(0x227)]=![];})[_0x275cf7(0x1e9)](function(){var _0x31cad6=_0x275cf7;_0x50b779[_0x31cad6(0x227)]=![];});},function(_0x5e5fd5){var _0x530374=_0x1a5bd1,_0xfe062e=_['get'](_0x5e5fd5,_0x530374(0x1d3),0x0),_0x5e88db='';if(_0xfe062e===0x1)_0x50b779[_0x530374(0x210)]=0x2,_0x5e88db='You\x20must\x20allow\x20this\x20permission\x20\x0ato\x20use\x20the\x20service:\x20\x0aPermissions\x20>\x20Location\x20>\x20Allow\x0aOtherwise,\x20you\x20can\x20go\x20to\x20one\x20of\x20our\x20scanner\x20to\x20log.';else{if(_0xfe062e===0x2)_0x50b779[_0x530374(0x210)]=0x3,_0x5e88db=_0x530374(0x207);else _0xfe062e===0x3?(_0x50b779['mapLocationErrorMode']=0x4,_0x5e88db=_0x530374(0x212)):_0x5e88db='Unknown\x20error.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.';}_0x50b779[_0x530374(0x227)]=![];},{'timeout':0x1388,'enableHighAccuracy':!![]}));},'loadLogPoint':function(){var _0x1a2994=_0x3aae67,_0x2b427e=this;_0x2b427e[_0x1a2994(0x227)]=!![],axios['get'](_0x1a2994(0x1e3)+employmentId+'/log-point',{'headers':{'X-Requested-With':_0x1a2994(0x21e)}})[_0x1a2994(0x1e9)](function(_0x268856){var _0x2f3b49=_0x1a2994,_0x175cd1=_['get'](_0x268856,_0x2f3b49(0x220));_0x2b427e['currentLogCheckPoint']=_[_0x2f3b49(0x1f2)](_0x175cd1,_0x2f3b49(0x228),0x0);if(_0x2b427e[_0x2f3b49(0x226)]===0x1||_0x2b427e[_0x2f3b49(0x226)]===0x2){}else _0x2b427e[_0x2f3b49(0x227)]=![],alert(_0x2b427e[_0x2f3b49(0x214)]+_0x2f3b49(0x20a)),window['location'][_0x2f3b49(0x222)]='/e-profile/dtr/'+employmentId+'';})[_0x1a2994(0x1d7)](function(_0x3bb06c){var _0x3b4071=_0x1a2994;if(_0x3bb06c[_0x3b4071(0x1de)]){var _0x19ef4a=_0x3bb06c['response']['data'];console[_0x3b4071(0x231)](_0x19ef4a);}else{if(_0x3bb06c[_0x3b4071(0x1da)]){var _0x54efd0=_0x3b4071(0x217);console['error'](_0x54efd0);}else{var _0x54efd0='Something\x20happened\x20in\x20setting\x20up\x20the\x20request\x20that\x20triggered\x20an\x20Error.';console[_0x3b4071(0x231)](_0x54efd0,_0x3bb06c['message']);}}_0x2b427e['pending']=![];})[_0x1a2994(0x1e9)](function(){var _0x397d65=_0x1a2994;_0x2b427e[_0x397d65(0x227)]=![];});},'loadMap':function(){var _0x5ab244=_0x3aae67,_0x439bee=this;if(!_0x439bee['map'])_0x439bee[_0x5ab244(0x20f)]=L['map'](_0x5ab244(0x20f));else return;var _0x4a9b64=_0x439bee[_0x5ab244(0x20f)];_0x4a9b64[_0x5ab244(0x224)]([10.69951,122.65067],0xf),_0x4a9b64[_0x5ab244(0x202)][_0x5ab244(0x1ea)]();var _0x51189d=L[_0x5ab244(0x1e0)](_0x5ab244(0x203),{'maxZoom':0x12,'attribution':'Developed\x20by\x20<a\x20target=\x22_blank\x22\x20href=\x22https://mis.gsc.edu.ph\x22>MIS</a>.\x20Map\x20data\x20by\x20<a\x20target=\x22_blank\x22\x20href=\x22https://www.openstreetmap.org/copyright\x22>OSM</a>.\x20'+'Imagery\x20by\x20<a\x20target=\x22_blank\x22\x20href=\x22https://www.mapbox.com/\x22>Mapbox</a>.','id':'mapbox/streets-v11','tileSize':0x200,'zoomOffset':-0x1})[_0x5ab244(0x232)](_0x4a9b64),_0x30f31e=L['polygon']([[10.6990108,122.6498571],[10.6980449,122.6508093],[10.6984059,122.6512063],[10.6984389,122.6511741],[10.6984883,122.651223],[10.6984369,122.6512827],[10.6991795,122.652086],[10.7000703,122.6511459],[10.7003233,122.6508602],[10.7007516,122.650305],[10.6998568,122.6493314],[10.6991544,122.650006],[10.6990108,122.6498571]],{'color':_0x5ab244(0x219)})[_0x5ab244(0x20b)](_0x5ab244(0x21b));_0x30f31e['addTo'](_0x4a9b64),_0x30f31e=L['polygon']([[10.6194448,122.5937879],[10.6188743,122.5976385],[10.6177542,122.5970157],[10.6181925,122.5933632],[10.6194448,122.5937879]],{'color':_0x5ab244(0x219)})[_0x5ab244(0x20b)](_0x5ab244(0x1f3)),_0x30f31e[_0x5ab244(0x232)](_0x4a9b64),_0x30f31e=L['polygon']([[10.5838882,122.6716331],[10.5839687,122.6713986],[10.5842046,122.6711531],[10.5843011,122.6711203],[10.5837542,122.6705312],[10.5830785,122.6699584],[10.5828909,122.6699966],[10.5824511,122.6706458],[10.5824029,122.6707549],[10.5838882,122.6716331]],{'color':_0x5ab244(0x219)})[_0x5ab244(0x20b)](_0x5ab244(0x1dd)),_0x30f31e[_0x5ab244(0x232)](_0x4a9b64);},'webcamStart':function(){var _0x1ef9f9=_0x3aae67,_0x3e9734=this;!_0x3e9734[_0x1ef9f9(0x1cd)]&&(_0x3e9734[_0x1ef9f9(0x227)]=!![],MediaDevicesPresets[_0x1ef9f9(0x1d6)](document[_0x1ef9f9(0x206)](_0x1ef9f9(0x208)),document[_0x1ef9f9(0x206)](_0x1ef9f9(0x20e)),{'width':0x160,'height':0x11d,'imageWidth':0x160,'imageHeight':0x11d})['then'](function(_0x3f6f59){var _0x5a00d7=_0x1ef9f9;_0x3e9734[_0x5a00d7(0x227)]=![],_0x3e9734[_0x5a00d7(0x1cd)]=_0x3f6f59,_0x3e9734[_0x5a00d7(0x1fc)]='';})['catch'](function(_0x534964){var _0x570e01=_0x1ef9f9;_0x3e9734[_0x570e01(0x1fc)]=_0x534964[_0x570e01(0x21f)];if(_0x534964[_0x570e01(0x1fa)]==_0x570e01(0x225)||_0x534964[_0x570e01(0x1fa)]==_0x570e01(0x233))_0x3e9734[_0x570e01(0x1fc)]+=_0x570e01(0x1ce);else{if(_0x534964[_0x570e01(0x1fa)]==_0x570e01(0x22f)||_0x534964[_0x570e01(0x1fa)]==_0x570e01(0x1d0))_0x3e9734[_0x570e01(0x1fc)]+=_0x570e01(0x1f8);else(_0x534964['name']==_0x570e01(0x1fb)||_0x534964[_0x570e01(0x1fa)]=='PermissionDeniedError')&&(_0x3e9734[_0x570e01(0x1fc)]+=_0x570e01(0x1f9));}})[_0x1ef9f9(0x1e9)](function(){var _0x429b92=_0x1ef9f9;_0x3e9734[_0x429b92(0x227)]=![];}));},'webcamPause':function(){var _0x26307c=_0x3aae67,_0x414703=this;_0x414703[_0x26307c(0x1cd)]&&document['getElementById'](_0x26307c(0x208))['pause']();},'webcamSnap':function(){var _0x1d32ef=_0x3aae67,_0x336c0a=this;_0x336c0a[_0x1d32ef(0x1cd)]&&(_0x336c0a[_0x1d32ef(0x211)]=_0x336c0a['webcamPhotoSnapper'][_0x1d32ef(0x1fd)]());},'webcamStop':function(){var _0x4dd5f0=_0x3aae67,_0x5a1bbe=this;_0x5a1bbe[_0x4dd5f0(0x1cd)]&&(_0x5a1bbe[_0x4dd5f0(0x1cd)]['stop'](),_0x5a1bbe[_0x4dd5f0(0x1cd)]=null);}}});function _0x5c39(_0x1ea3bc,_0x364f57){var _0x1263dc=_0x1263();return _0x5c39=function(_0x5c3991,_0xdf07a){_0x5c3991=_0x5c3991-0x1cc;var _0x3a5351=_0x1263dc[_0x5c3991];return _0x3a5351;},_0x5c39(_0x1ea3bc,_0x364f57);}function _0x1263(){var _0x47c17e=['Location\x20failed.\x20Please\x20try\x20again\x20later\x20or\x20go\x20to\x20the\x20scanner\x20to\x20log.','detectLocation','nextLogCheckPoint','/logs','Your\x20Location!','The\x20request\x20was\x20made\x20but\x20no\x20response\x20was\x20received','hh:mm\x20A','green','205530mEUzig','Salvador\x20Campus\x20Boundaries','getItem','page','XMLHttpRequest','message','data','webcamStart','href','webcamLoaded','setView','NotFoundError','currentLogCheckPoint','pending','checkPoint','mapMarker','/online','coords.latitude','getCurrentPosition','168XQgnJk','1006722QwfGNz','NotReadableError','navigator.geolocation','error','addTo','DevicesNotFoundError','startTimer','654712QfdjhQ','webcamPhotoSnapper','.\x20Please\x20check\x20if\x20you\x20have\x20a\x20camera.','latLon.1','TrackStartError','loadLogPoint','Afternoon\x20Out','code','post','addEventListener','createWebcamPhotoSnapper','catch','mapLocationResultName','Your\x20browser\x20does\x20not\x20support\x20the\x20online\x20time-in/time-out.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.','request','removeLayer','webcamSnap','Baterna\x20Campus\x20Boundaries','response','log','tileLayer','location','latLon','/e-profile/dtr/','validationMixin','icon','3497208jvXPlJ','Asia/Manila','Something\x20happened\x20in\x20setting\x20up\x20the\x20request\x20that\x20triggered\x20an\x20Error.','then','disable','vuelidate','171uCLpCo','/images/marker-1.png','/location','Extended\x20Out','349161NkxaIB','94280kpQtYm','get','Mosqueda\x20Campus\x20Boundaries','msg','dontme','Afternoon\x20In','setItem','.\x20Please\x20close\x20the\x20other\x20app\x20that\x20is\x20using\x20the\x20camera','.\x20Please\x20allow\x20HRIS\x20to\x20use\x20your\x20camera.','name','NotAllowedError','webcamError','snap','format','carousel','loadMap','Your\x20are\x20inside\x20','scrollWheelZoom','https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia29zaW5peCIsImEiOiJjamFsd2t3Y3QydW05MzNxdXUyeWV6azhoIn0.aqHKe7JGKQrNMD5-WP8xDQ','countdown','hrisOnlineLogFirstRun','getElementById','Service\x20currently\x20unavailable.\x20Please\x20go\x20to\x20the\x20scanner\x20to\x20log.','webcam-feed','#carousel-map','\x20is\x20not\x20allowed\x20online.\x20Please\x20use\x20our\x20scanners.','bindPopup','517734iCHKTl','Morning\x20Out','webcam-snapshot','map','mapLocationErrorMode','webcamPhoto'];_0x1263=function(){return _0x47c17e;};return _0x1263();}
</script>
{% endblock %}

